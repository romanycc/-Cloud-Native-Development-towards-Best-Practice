from fastapi.testclient import TestClient
from earthquake import app

client = TestClient(app)

def test_earthquake_fetch():
    response = client.post("/earthquake_fetch/", json = {
        "year_to": 2021,
        "month_to": 5,
        "day_to": 1,
        "hour_to": 0,
        "past_hours": 1,
        "reservoir_names": ["北", "中"],
  },
    headers = {
        "Content-Type": "application/json"
    })
    assert response.status_code == 422
    assert response.json() == {"detail":[{"loc":["body","earthquake_regions"],"msg":"field required","type":"value_error.missing"}]}   
    
    response = client.post("/earthquake_fetch/", json = {
        "year_to": 2020,
        "month_to": 7,
        "day_to": 1,
        "hour_to": 0,
        "past_days": 5,
        "earthquake_regions": ["北", "中"],
    },
    headers = {
        "Content-Type": "application/json"
    })
    
    assert response.status_code == 200
    assert response.json() == {"data":[{"區":"中","時間":["2020-06-26 00:33:17","2020-06-26 17:56:34","2020-06-26 20:23:51","2020-06-26 22:16:34","2020-06-27 07:27:45","2020-06-27 07:28:51","2020-06-27 07:33:31","2020-06-27 07:34:45","2020-06-27 07:42:15","2020-06-27 07:42:30","2020-06-27 07:45:46","2020-06-27 07:53:52","2020-06-29 07:10:14","2020-06-29 13:08:34","2020-06-29 20:52:48","2020-06-29 22:59:07","2020-06-29 23:53:32","2020-06-30 20:17:12"],"震度階級":[0,0,0,0,2,0,0,1,0,0,0,0,0,1,1,0,0,0],"震央經度":[121.39,120.69,121.37,120.25,120.84,120.83,120.84,120.84,120.84,120.83,120.83,120.85,121.31,121.62,122.34,120.79,120.82,121.58],"震央緯度":[23.74,23.16,22.06,23.38,23.05,23.05,23.05,23.05,23.05,23.06,23.05,23.04,23.26,23.87,24.31,23.19,23.22,23.18],"震央規模":[2.83,2.36,3.95,2.26,5.05,3.48,2.9,4.34,3.89,2.89,3.13,3.28,2.98,4.77,5.32,2.6,2.03,4.56],"震央深度":[22.63,8.78,19.28,7.56,5.37,6.22,6.41,4.94,4.82,5.41,4.06,4.79,9.63,41.98,64.59,5.18,4.17,38.64],"震央震度階級":[3,2,3,3,4,1,1,4,4,1,2,2,2,3,3,2,2,3]},{"區":"北","時間":["2020-06-26 00:33:17","2020-06-26 17:56:34","2020-06-26 20:23:51","2020-06-26 22:16:34","2020-06-27 07:27:45","2020-06-27 07:28:51","2020-06-27 07:33:31","2020-06-27 07:34:45","2020-06-27 07:42:15","2020-06-27 07:42:30","2020-06-27 07:45:46","2020-06-27 07:53:52","2020-06-29 07:10:14","2020-06-29 13:08:34","2020-06-29 20:52:48","2020-06-29 22:59:07","2020-06-29 23:53:32","2020-06-30 20:17:12"],"震度階級":[0,0,0,0,2,0,0,1,0,0,0,0,0,2,2,0,0,1],"震央經度":[121.39,120.69,121.37,120.25,120.84,120.83,120.84,120.84,120.84,120.83,120.83,120.85,121.31,121.62,122.34,120.79,120.82,121.58],"震央緯度":[23.74,23.16,22.06,23.38,23.05,23.05,23.05,23.05,23.05,23.06,23.05,23.04,23.26,23.87,24.31,23.19,23.22,23.18],"震央規模":[2.83,2.36,3.95,2.26,5.05,3.48,2.9,4.34,3.89,2.89,3.13,3.28,2.98,4.77,5.32,2.6,2.03,4.56],"震央深度":[22.63,8.78,19.28,7.56,5.37,6.22,6.41,4.94,4.82,5.41,4.06,4.79,9.63,41.98,64.59,5.18,4.17,38.64],"震央震度階級":[3,2,3,3,4,1,1,4,4,1,2,2,2,3,3,2,2,3]}]}